#pragma config(Motor,  motor1,          left,          tmotorVexIQ, PIDControl, encoder)
#pragma config(Motor,  motor2,          right,         tmotorVexIQ, PIDControl, reversed, encoder)
#pragma config(Motor,  motor3,          side,          tmotorVexIQ, PIDControl, encoder)
#pragma config(Motor,  motor5,          rightArmMotor, tmotorVexIQ, PIDControl, reversed, encoder)
#pragma config(Motor,  motor10,         frontClaw,     tmotorVexIQ, PIDControl, encoder)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

static float armRequestedValue;
static bool armMoving;

task armPID(){

			resetMotorEncoder(rightArmMotor);
			float  pidError;
  	  float  pidLastError;
  	  float  pidIntegral;
   	  float  pidDerivative;
    	float  pidDrive;

			float  pidKp = 3.5;
			float  pidKi = 0.03;
			float  pidKd = 0.01;

    	pidLastError = 0;
			pidIntegral = 0;

			while(true){
					if(armMoving){
							pidError = (getMotorEncoder(rightArmMotor)) - armRequestedValue;
							//writeDebugStreamLine("%d - %d == %d\n", (getMotorEncoder(rightArmMotor)),armRequestedValue, pidError);
							if(pidKi != 0)
                {
                		if(abs(pidError) < 100)
                 		 	  pidIntegral = pidIntegral + pidError;
                		else
                  		  pidIntegral = 0;
                }
              pidDerivative = pidError - pidLastError;
  	          pidLastError  = pidError;

  	          pidDrive = (pidKp * pidError) + (pidKi * pidIntegral) + (pidKd * pidDerivative);
							//writeDebugStreamLine("%d\n", pidDrive);

              if(pidDrive > 100)
              		pidDrive = 100;
              if(pidDrive < -100)
              		pidDrive = -100;
              motor[rightArmMotor] = -pidDrive;

					}
					else{
							pidError = 0;
    			    pidLastError = 0;
  		    	  pidIntegral = 0;
           	  pidDerivative = 0;
           	  motor[rightArmMotor] = 0;
         }
         wait1Msec(25);
			}
}
task main()
{
		startTask(armPID);
		armMoving = true;

		while(true) {
			if(abs(getJoystickValue(ChA)) > 20 || abs(getJoystickValue(ChC)) > 20){
					motor[right] = getJoystickValue(ChA) - getJoystickValue(ChC);
					motor[left] = getJoystickValue(ChA) + getJoystickValue(ChC);
			}
			else{
					motor[left] = 0;
					motor[right] = 0;
			}

			if(abs(getJoystickValue(ChB)) > 20){
					motor[side] = getJoystickValue(ChB);
			}
			else{
					motor[side] = 0;
			}
			// && armRequestedValue > -460
			if(getJoystickValue(BtnLUp) == 1 && armRequestedValue > -1414) {
					armRequestedValue -= 0.06;
			}

			else if(getJoystickValue(BtnLDown) == 1 && armRequestedValue < 50) {
					armRequestedValue += 0.06;
			}

			if(getJoystickValue(BtnRUp) == 1){
					motor[frontClaw] = 50;
			}
			else if(getJoystickValue(BtnRDown) == 1){
					motor[frontClaw] = -50;
			}
			else{
					motor[frontClaw] = 0;
			}
			if(getJoystickValue(BtnFDown)){
					armRequestedValue = -320;
			}
			if(getJoystickValue(BtnFUp)){
					motor[frontClaw] = -100;
					motor[left] = -80;
					motor[right] = -80;
					wait10Msec(30);
					motor[left] = 0;
					motor[right] = 0;
					wait10Msec(20);
					armRequestedValue = -950;
					wait10Msec(50);
					motor[left] = -80;
					motor[right] = -80;
					wait10Msec(80);

				}
		}
}
