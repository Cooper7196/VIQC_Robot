#pragma config(Motor,  motor1,          left,          tmotorVexIQ, PIDControl, encoder)
#pragma config(Motor,  motor2,          right,         tmotorVexIQ, PIDControl, reversed, encoder)
#pragma config(Motor,  motor3,          side,          tmotorVexIQ, PIDControl, encoder)
#pragma config(Motor,  motor5,          rightArmMotor, tmotorVexIQ, PIDControl, encoder)
#pragma config(Motor,  motor6,          leftArmMotor,  tmotorVexIQ, PIDControl, reversed, encoder)
#pragma config(Motor,  motor10,         frontClaw,     tmotorVexIQ, PIDControl, encoder)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

static float armRequestedValue;
static bool armMoving;

task moveArm(){
		while(true){
			if(abs((getMotorEncoder(leftArmMotor) + getMotorEncoder(rightArmMotor)) / 2) - -200 > 200){
					if(((getMotorEncoder(leftArmMotor) + getMotorEncoder(rightArmMotor)) / 2) > -200){
						motor[leftArmMotor] = -100;
						motor[rightArmMotor] = -100;
					}
					if(((getMotorEncoder(leftArmMotor) + getMotorEncoder(rightArmMotor)) / 2) < -200){
						motor[leftArmMotor] = 100;
						motor[rightArmMotor] = 100;
					}
			}
				else{

					motor[leftArmMotor] = 0;
					motor[rightArmMotor] = 0;
					stopTask(moveArm);
				}
		}
}
task armPID(){

			resetMotorEncoder(rightArmMotor);
			float  pidError;
  	  float  pidLastError;
  	  float  pidIntegral;
   	  float  pidDerivative;
    	float  pidDrive;

			float  pidKp = 1;
			float  pidKi = 0.02;
			float  pidKd = 0.01;

    	pidLastError = 0;
			pidIntegral = 0;

			while(true){
					if(armMoving){
							pidError = (getMotorEncoder(rightArmMotor)) - armRequestedValue;
							//writeDebugStreamLine("%d - %d == %d\n", (getMotorEncoder(rightArmMotor)),armRequestedValue, pidError);
							if(pidKi != 0)
                {
                		if(abs(pidError) < 10000000000000)
                 		 	  pidIntegral = pidIntegral + pidError;
                		else
                  		  pidIntegral = 0;
                }
              pidDerivative = pidError - pidLastError;
  	          pidLastError  = pidError;

  	          pidDrive = (pidKp * pidError) + (pidKi * pidIntegral) + (pidKd * pidDerivative);
							//writeDebugStreamLine("%d\n", pidDrive);

              if(pidDrive > 100)
              		pidDrive = 100;
              if(pidDrive < -100)
              		pidDrive = -100;
              motor[rightArmMotor] = -pidDrive;
              motor[leftArmMotor] = motor[rightArmMotor];

					}
					else{
							pidError = 0;
    			    pidLastError = 0;
  		    	  pidIntegral = 0;
           	  pidDerivative = 0;
           	  motor[rightArmMotor] = 0;
           	  motor[leftArmMotor] = motor[rightArmMotor];
         }
         wait1Msec(25);
			}
}
int Notes[][]= {
{695, 25},
{695, 25},
{788, 25},
{877, 25},
{877, 25},
{788, 25},
{695, 25},
{656, 25},
{590, 25},
{590, 25},
{656, 25},
{695, 25},
{695, 25},
{656, 13},
{656, 50},
{695, 25},
{695, 25},
{788, 25},
{877, 25},
{877, 25},
{788, 25},
{695, 25},
{656, 25},
{590, 25},
{590, 25},
{656, 25},
{695, 25},
{656, 25},
{590, 13},
{590, 50},
{656, 25},
{656, 25},
{695, 25},
{590, 25},
{656, 25},
{695, 13},
{788, 13},
{695, 25},
{590, 25},
{656, 25},
{695, 13},
{788, 13},
{695, 25},
{656, 25},
{590, 25},
{656, 25},
{440, 50},
{695, 25},
{695, 25},
{788, 25},
{877, 25},
{877, 25},
{788, 25},
{695, 25},
{656, 25},
{590, 25},
{590, 25},
{656, 25},
{695, 25},
{656, 25},
{590, 13},
{590, 50},
};
task main()
{
		startTask(armPID);
		armMoving = true;
		//armRequestedValue = -100
		bool isReversed = false;
		clearTimer(T1);

		for (int i=0; i<62; i++)
		{
		playTone(Notes[i][0], Notes[i][1]);
		playSound(sound);

		while(bSoundActive);
		}
		while(true) {

			//writeDebugStreamLine("rightArmMotor: %d\n", getMotorEncoder(rightArmMotor));
			writeDebugStreamLine("difference: %d\n", motor[rightArmMotor] - motor[leftArmMotor]);
			//writeDebugStreamLine("%s\n", sensorType[gyro]);
			motor[leftArmMotor] = motor[rightArmMotor];
			motor[left] = getJoystickValue(ChA) + getJoystickValue(ChC);
			motor[right] = getJoystickValue(ChA) - getJoystickValue(ChC);
			if(abs(getJoystickValue(ChB)) > 20){
					motor[side] = getJoystickValue(ChB);
			}
			else{
					motor[side] = 0;
			}
		if(getJoystickValue(BtnLUp) == 1 && armRequestedValue > -460) {
				armRequestedValue -= 0.04;
		}

		else if(getJoystickValue(BtnLDown) == 1 && armRequestedValue < 50) {
				armRequestedValue += 0.04;
		}

		if(getJoystickValue(BtnRUp) == 1){
				motor[frontClaw] = 50;
		}
		else if(getJoystickValue(BtnRDown) == 1){
				motor[frontClaw] = -50;
		}
		else{
				motor[frontClaw] = 0;
		}
		if(getJoystickValue(BtnFDown)){
				//armRequestedValue = -110;
  //        100 = Tempo
  //          6 = Default octave
  //    Quarter = Default note length
  //        10% = Break between notes
  //



		}
		if(getJoystickValue(BtnFUp)){
				motor[frontClaw] = -100;
				motor[left] = -80;
				motor[right] = -80;
				wait10Msec(30);
				armRequestedValue = -310;
				motor[left] = 0;
				motor[right] = 0;
				wait10Msec(100);
				motor[left] = -80;
				motor[right] = -80;
				wait10Msec(50);

		}
	}
}
